from flask import Flask, request, jsonify
import mysql.connector
from flask_cors import CORS

app = Flask(__name__)
CORS(app)

db = mysql.connector.connect(
    host="your-db-ip",
    user="asriuser",
    password="asripassword",
    database="asribank"
)

cursor = db.cursor()

@app.route('/signup', methods=['POST'])
def signup():
    username = request.form['username']
    password = request.form['password']
    email = request.form['email']
    age = request.form['age']
    cursor.execute("""
        INSERT INTO users (username, password, email, age, balance)
        VALUES (%s, %s, %s, %s, %s)
    """, (username, password, email, age, 0))
    db.commit()
    return "Account created!"

@app.route('/login', methods=['POST'])
def login():
    username = request.form['username']
    password = request.form['password']
    cursor.execute("SELECT * FROM users WHERE username=%s AND password=%s", (username, password))
    user = cursor.fetchone()
    return "Login success" if user else "Login failed"

@app.route('/update_balance', methods=['POST'])
def update_balance():
    data = request.get_json()
    cursor.execute("UPDATE users SET balance=%s WHERE username=%s", (data['balance'], data['username']))
    db.commit()
    return jsonify({"message": "Balance updated successfully!"})

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)
